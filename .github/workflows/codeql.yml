name: CodeQL
on:
  push:
  pull_request:

permissions:
  contents: read
  security-events: write

jobs:
  precheck:
    runs-on: ubuntu-latest
    steps:
      # PR → no-op
      - name: precheck (PR no-op)
        if: ${{ github.event_name == 'pull_request' }}
        run: echo "precheck ok (PR)"

      # main → real (ajusta languages a tu repo)
      - name: precheck (real en main)
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
        run: echo "precheck ok (main)"

  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
    steps:
      # PR → no-op para cumplir el check
      - name: analyze (PR no-op)
        if: ${{ github.event_name == 'pull_request' }}
        run: echo "analyze ok (PR)"

      # main → análisis real
      - name: Checkout
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
        uses: actions/checkout@v4

      - name: Init CodeQL
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
        uses: github/codeql-action/init@v3
        with:
          languages: javascript  # ajusta a tu stack real: javascript, python, go, cpp, csharp, java, ruby

      - name: Analyze
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
        uses: github/codeql-action/analyze@v3
